# Scanning and OS Fingerprinting -lab

In this lab environment, the user is going to get access to a Kali GUI instance. There are a few machines on the same network running various services.

Objective: Perform scanning and OS fingerprinting using the Nmap tool and answer the following questions:

1. How many machines are there?
2. What ports are open on pc1.ine.local machine?
3. What OS is running on machine pc1.ine.local machine?
4. What services are running on pc2.ine.local machine?
5. What is the version of the FTP server running on one of the machines?
6. A caching server is also running on one of the machines. What is the domain name of that machine?
7. A NoSQL database and SQL database services are running on different machines. Can we use Nmap scripts to extract some information from those?

## 1. How many machines are there?

Find out the ip address for the provided host by running command:

    ip addr

Two interfaces (plus loopback) shown: eth0 and eth1. eth1 address is given as 192.67.80.2/24.

Perform a ping scan / ping sweep of the network with nmap using:

    nmap -sn 192.67.80.2/24

Scan shows six live hosts in the network:

* linux (192.67.80.1)
* pc1.ine.local (192.67.80.3)
* pc2.ine.local (192.67.80.4)
* pc3.ine.local (192.67.80.5)
* pc4.ine.local (192.67.80.6)
* INE (192.67.80.2, provided host machine)

## 2. What ports are open on pc1.ine.local?

Run a TCP Connect -scan on the first 1000 ports (nmap default) on the target machine (pc1.ine.local, 192.67.80.3) using nmap and redirect output to file:

    nmap -sT 192.67.80.3 > nmap.txt

The scan shows three open ports:

* 80/tcp - http
* 443/tcp - https
* 3306/tcp - mysql

To scan all ports, run the command with the port flag (-p-):

    nmap -sT -p- 192.67.80.3

The scan gives the same three results as with the default port range. The open ports indicate that the host is likely a web server with the mysql-service also exposed, which is unusual but can be ok in internal networks. 

## 3. What OS is running on machine pc1.ine.local?

OS detection scan can be done with nmap:

    nmap -O 192.67.80.3

The scan shows that the OS is Linux kernel 4.15 - 5.6. If the scan is run with the more aggressive OS guessing (--osscan-guess) the result is 5.0 - 5.3:

    nmap -O --osscan-guess 192.67.80.3

## 4. What services are running on pc2.ine.local machine?

Run a TCP Connect -scan on target: pc2.ine.local (192.67.80.4):

    nmap -sT -p- 192.67.80.4

Scan shows only one open port: 

* 27017/tcp - mongod

The target is a mongoDB server. 

## 5. What is the version of the FTP server running on one of the machines?

Run a TCP Connect scan on all machines on the network to find the FTP-server (default port is 21):

    nmap -sT 192.67.80.2/24

FTP server is found from the host pc4.ine.local (192.67.80.6). Service version can be scanned with nmap by running:

    nmap -sV 192.67.80.6

The scan shows that the FTP version is vsftpd (very secure FTP daemon) 3.0.3. 

The scan could also be run with one command using '*' as a wildcard and --open to only show hosts with port 21 open:

    nmap -p21 -sV 192.67.80.* --open

## 6. A caching server is also running on one of the machines. What is the domain name of that machine?

Running TCP Connect scan on all ports for the network:

    nmap -p- 192.67.80.2/24

This shows that the host 192.67.80.5 (pc3.ine.local) has one open port:

* 11211/tcp - memcache

## 7. A NoSQL database and SQL database services are running on different machines. Can we use Nmap scripts to extract some information from those?

SQL-database is running on host pc1.ine.local (192.67.80.3). NoSQL (MongoDB) is running on host pc2.ine.local (192.67.80.4). 

Get info about mySQL server with the script mysql-info:

    nmap -sC --script=mysql-info pc1.ine.local > mysql.txt

The scan gives out information such as 

* The mySQL version: 5.5.47 
* Server version: Ubuntu 14.04.1
* Salt: \Y([rMiIq|;O\\`MCGyMS


Try a brute force attack on the mySQL server:

    nmap -sC --script=mysql-brute pc1.ine.local >> mysql.txt

The brute force does not find any valid accounts.

Get info about the MongoDB database:

    nmap -p21017 -sC --script=mongodb-info pc2.ine.local > mongodb.txt

A lot of information is shown about the database including the mongoDB version: 3.6.3

Get database names from the mongoDB:

    nmap -p21017 -sC --script=mongodb-databases pc2.ine.local

Four databases were found: local, admin, city and config. No password was required. 

Try a brute force attack on the mongoDB database:

    nmap -p21017 -sC --script=mongodb-brute pc2.ine.local

Brute force script informs that no authentication is needed for the server. 
